from django.shortcuts import render
from django.views.generic import View
from django.http import JsonResponse
from django.db import connection
from django.conf import settings

from elasticsearch_dsl import Search, Q, A
# Create your views here.

from localinfo.models import TimePeriod

# from errors import ESQueryDoesNotHaveParameters

# elastic search index name
INDEX_NAME="velocity"

class LoadMatrixView(View):
    ''' '''

    def __init__(self):
        ''' contructor '''
        self.context={}
        self.context['routes'] = self.getRouteList()

    def getRouteList(self):
        ''' retrieve all routes availables in elasticsearch'''
        client = settings.ES_CLIENT
        esQuery = Search(using=client, index=INDEX_NAME)
        esQuery = esQuery[:0]
        aggs = A('terms', field = 'route', size=1000)
        esQuery.aggs.bucket('unique_routes', aggs)

        routes = []
        for tag in esQuery.execute().aggregations.unique_routes.buckets:
            routes.append(tag.key)
        routes.sort()

        return routes
        # return ['ASDF 00I', 'QWERTY 00R', 'OMFG E0 00R']

    def get(self, request):
        template = "velocity/matrix.html"

        return render(request, template, self.context)

class getLoadMatrixData(View):

    def __init__(self):
        self.context = {}

    def get(self, request):
        fromDate = request.GET.get('from', None)
        toDate = request.GET.get('to', None)
        route = request.GET.get('route', None)

        client = settings.ES_CLIENT
        esQuery = Search(using=client, index=INDEX_NAME)
        esQuery = esQuery.filter("term", route=route)
        esQuery = esQuery.filter("range", timePeriod={'gte': fromDate+' 00:00', 'lte': toDate+' 23:31', 'format': 'dd/MM/yyyy HH:mm', 'time_zone': 'America/Santiago'})
        aggs2 = A('terms', field = 'timePeriod', format='HH:mm', size=1000)
        aggs2.metric('distance', 'sum', field='totalDistance')
        aggs2.metric('time', 'sum', field='totalTime')
        aggs1 = A('terms', field = 'section', size=1000)
        esQuery.aggs.bucket('sections', aggs1).bucket('periods', aggs2)

        result = esQuery.execute()

        d_data = {}
        for section in result.aggregations.sections.buckets:
            key_section = section.key
            for period in section.periods.buckets:
                key_period = period.key_as_string
                d_data[(key_section, key_period)] = -1 if period.time.value==0 else 3.6*period.distance.value/period.time.value

        max_section = max([k[0] for k in d_data.keys()])

        response = {
            'hours': ["00:00", "00:30", "01:00", "01:30", "02:00", "02:30", "03:00", "03:30", "04:00", "04:30", "05:00", "05:30", "06:00", "06:30", "07:00", "07:30", "08:00", "08:30", "09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "12:00", "12:30", "13:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00", "19:30", "20:00", "20:30", "21:00", "21:30", "22:00", "22:30", "23:00", "23:30"],
            'segments': list(range(max_section+1)),
            'data': [],
        }

        for section in response['segments']:
            for hour in response['hours']:
                velocity = d_data.get((section, hour), -1)
                interval = 6
                for i, bound in enumerate([0, 15, 19, 21, 23, 30]):
                    if velocity < bound:
                        interval = i
                        break
                response['data'].append([response['hours'].index(hour), section, interval])

####################################################################################
# HARDCODED for development purpose
####################################################################################
        route_points = [
            [-33.46553760696665, -70.53118851830361],
            [-33.4655285904956, -70.53118835973042],
            [-33.46539148267049, -70.53133659077487],
            [-33.46534640031715, -70.53133579783739],
            [-33.46468356710884, -70.53096905702583],
            [-33.46455800088485, -70.53091304875016],
            [-33.464441451102516, -70.53085719917468],
            [-33.46427981891628, -70.53080055712566],
            [-33.46412693744326, -70.53076558917124],
            [-33.463928973576834, -70.53072982876886],
            [-33.463712711023625, -70.53071526677732],
            [-33.46291064318961, -70.53066888679449],
            [-33.462811594791326, -70.53065638574347],
            [-33.46255926627071, -70.53064119023787],
            [-33.46237018592755, -70.53061634685976],
            [-33.46218137125279, -70.53056998873045],
            [-33.45997062129608, -70.52993935843425],
            [-33.459808988446824, -70.52988272131675],
            [-33.459638471842446, -70.52981516889635],
            [-33.45924373782133, -70.52964684337053],
            [-33.45916312043024, -70.52960238971184],
            [-33.459157145933546, -70.53008645778645],
            [-33.45914587192563, -70.5302691694712],
            [-33.45913499610305, -70.53041960991114],
            [-33.45914321567113, -70.53048431074575],
            [-33.45913074550027, -70.53076383586976],
            [-33.45910673351363, -70.53124758642052],
            [-33.45908271964602, -70.53173133662862],
            [-33.45907224088148, -70.53184950556371],
            [-33.45906136314944, -70.5319999456021],
            [-33.45902713288881, -70.5325803499108],
            [-33.45900191639475, -70.53316091239215],
            [-33.45896714829677, -70.53378434372908],
            [-33.45894285826648, -70.53428960610248],
            [-33.45893091224081, -70.53452610162772],
            [-33.45890994930001, -70.53476243816651],
            [-33.458877171772244, -70.53522451279447],
            [-33.45885340899297, -70.53568674600405],
            [-33.4588196948271, -70.5362241188067],
            [-33.458796195051455, -70.53666483731024],
            [-33.458763010271554, -70.53715918128105],
            [-33.45873817275868, -70.53770746888151],
            [-33.45871480121541, -70.53813742938794],
            [-33.45870298138313, -70.5383631665011],
            [-33.45869182874797, -70.53853511870348],
            [-33.45867085820647, -70.53877145332109],
            [-33.45865028789279, -70.53897551692891],
            [-33.45859932824843, -70.53944802614083],
            [-33.458548099538504, -70.5399420486118],
            [-33.45849686887527, -70.54043607042283],
            [-33.45845425151676, -70.54096252188867],
            [-33.45836408711628, -70.54096092646849],
            [-33.45832802135571, -70.5409602883024],
            [-33.457544794488285, -70.54084959715323],
            [-33.457121690265794, -70.5407883157413],
            [-33.45678861669969, -70.54073938680541],
            [-33.455960440800055, -70.54061714607252],
            [-33.455231178164645, -70.5405181752566],
            [-33.45446598319485, -70.54040781205975],
            [-33.45368288873454, -70.54028637584315],
            [-33.45298067477705, -70.54018788943804],
            [-33.4518284397256, -70.54001689753285],
            [-33.45166627718001, -70.5400032721721],
            [-33.45156722980666, -70.53999076267384],
            [-33.450049659246105, -70.54018985817918],
            [-33.44996944654605, -70.54011313230605],
            [-33.449576196362074, -70.53982646695361],
            [-33.44910233156291, -70.53949534707475],
            [-33.44886990701032, -70.5393298681701],
            [-33.44863734866433, -70.53917514588714],
            [-33.44817236480717, -70.53885494818583],
            [-33.44774304540896, -70.53856765772113],
            [-33.44769836352555, -70.53853459474456],
            [-33.447394339605765, -70.53832482522103],
            [-33.446875788104116, -70.5379606597676],
            [-33.446562746589365, -70.53775073516748],
            [-33.44620515584746, -70.53749699481415],
            [-33.446026426938595, -70.5373647477287],
            [-33.44599022767175, -70.53737486675375],
            [-33.44547167293669, -70.53701071305247],
            [-33.44497074999642, -70.5366791476446],
            [-33.444917984179476, -70.53657064078014],
            [-33.444819602699404, -70.53650436013072],
            [-33.444765237236915, -70.53652491665504],
            [-33.444496608900046, -70.53636957352344],
            [-33.44439836056525, -70.53629253822317],
            [-33.44394265104119, -70.53595102072997],
            [-33.44386216890162, -70.53589581456085],
            [-33.44369218805353, -70.5357852436171],
            [-33.44313769516977, -70.53540971878253],
            [-33.4419931719636, -70.5346150288824],
            [-33.44191242290147, -70.53458133506291],
            [-33.44187635693693, -70.5345806999343],
            [-33.44144153008255, -70.53546589028906],
            [-33.441385832781876, -70.53559399521386],
            [-33.44133000213833, -70.53573285480877],
            [-33.441301886927334, -70.53581841678853],
            [-33.44127323873222, -70.53594699803035],
            [-33.44124325791398, -70.53618312743406],
            [-33.44123237578388, -70.53633353601475],
            [-33.441212610267605, -70.53647303075611],
            [-33.441060028958795, -70.53786876993433],
            [-33.4409800249649, -70.53850202917864],
            [-33.440979758054944, -70.53852353873975],
            [-33.440959322747666, -70.53871680636814],
            [-33.44092973717765, -70.53892066944202],
            [-33.4409288027236, -70.53899595284642],
            [-33.44090916774948, -70.53912469161047],
            [-33.44087958151571, -70.53932855440198],
            [-33.440879314463096, -70.53935006392996],
            [-33.440807918695405, -70.54001574379052],
            [-33.440697245838415, -70.54093889841586],
            [-33.44066685454311, -70.54120728834853],
            [-33.44057567720163, -70.54201245688415],
            [-33.440444413632896, -70.54313962578902],
            [-33.440470927578296, -70.54318312354269],
            [-33.44043446017301, -70.54321474895855],
            [-33.44035402737928, -70.54388026169033],
            [-33.44029296366009, -70.54443854600264],
            [-33.4402526104554, -70.54478205596286],
            [-33.44017230337874, -70.54543681087739],
            [-33.4401319474337, -70.54578031978924],
            [-33.440111635009984, -70.54596282874736],
            [-33.440051232714374, -70.54646733654431],
            [-33.44004087480944, -70.54657472278646],
            [-33.44002056122655, -70.54675723132185],
            [-33.43994024381581, -70.54741198225584],
            [-33.439919929011474, -70.54759449033597],
            [-33.439890194734986, -70.54780910198266],
            [-33.43986961080339, -70.5480131190331],
            [-33.439840010102536, -70.54821697579338],
            [-33.43981929119497, -70.54843174719026],
            [-33.439799243554674, -70.54859274555162],
            [-33.439789689812855, -70.54863560366321],
            [-33.43973842754659, -70.54912951301016],
            [-33.43966859280478, -70.54966611929714],
            [-33.43941453019565, -70.55195282532303],
            [-33.439431082215, -70.55207144618389],
            [-33.43942058486005, -70.55218958531918],
            [-33.439399724470285, -70.55241510897564],
            [-33.43936930854994, -70.55268348991318],
            [-33.43933014503783, -70.55293020096539],
            [-33.43930053633217, -70.55313405447006],
            [-33.439272139868734, -70.55324111736913],
            [-33.43913876828552, -70.5538088549454],
            [-33.439108888568505, -70.55403421658943],
            [-33.439097580517306, -70.5542168817898],
            [-33.43910443984556, -70.55438911409365],
            [-33.43911251245712, -70.55446455619442],
            [-33.439161486630645, -70.55487419116152],
            [-33.43925432730307, -70.55538142141421],
            [-33.43926212946557, -70.55547837267778],
            [-33.43926993155172, -70.55557532395565],
            [-33.439268852092944, -70.55566135981748],
            [-33.43923211178099, -70.55571448842002],
            [-33.439212189713146, -70.55586472916487],
            [-33.43920276844416, -70.55589683161702],
            [-33.439183655956406, -70.55598254544033],
            [-33.43914624065953, -70.55608944617786],
            [-33.439172210057016, -70.55617596489455],
            [-33.43909967388746, -70.5562069402782],
            [-33.43893400378929, -70.55647290319774],
            [-33.43894207513146, -70.5565483452914],
            [-33.438905064419544, -70.55662298217621],
            [-33.43888163014731, -70.55705283724828],
            [-33.438898717535785, -70.55712844043187],
            [-33.43889588102858, -70.55735428343118],
            [-33.438884162813416, -70.55756921083078],
            [-33.438872444227236, -70.55778413815736],
            [-33.43886086040692, -70.55798831099072],
            [-33.43883647517857, -70.55849344618801],
            [-33.43882543097873, -70.5586546011458],
            [-33.43881249356713, -70.55896631779089],
            [-33.438800231602826, -70.55922426228007],
            [-33.43876628381358, -70.55977225280772],
            [-33.438753614235786, -70.56006246016757],
            [-33.43874080863949, -70.56036342180849],
            [-33.4387274608355, -70.56070740089103],
            [-33.438691475127165, -70.56141670584991],
            [-33.438657382208284, -70.56197544881748],
            [-33.43865521438587, -70.56214751880391],
            [-33.4386339294506, -70.56240530046809],
            [-33.438632845271684, -70.56249133542283],
            [-33.43862274465671, -70.5625772087148],
            [-33.438610881872165, -70.56280288873229],
            [-33.438609661857136, -70.56289967801213],
            [-33.438599560961265, -70.56298555122238],
            [-33.43858851094995, -70.56314670493369],
            [-33.438566817129974, -70.56343674914011],
            [-33.43856573223742, -70.56352278398633],
            [-33.43855454590167, -70.56369469189161],
            [-33.43853393601864, -70.56389870100126],
            [-33.43852342746631, -70.56401683703648],
            [-33.438500239052544, -70.56442517850138],
            [-33.43848864434354, -70.56462934913165],
            [-33.438466675600324, -70.56494090116674],
            [-33.43845630180856, -70.56504828261035],
            [-33.438454808533045, -70.5651665802818],
            [-33.438433381576935, -70.56543511468833],
            [-33.43843188793333, -70.56555341230684],
            [-33.43837865699552, -70.56619786173427],
            [-33.43831300852363, -70.56711100580985],
            [-33.43831219295354, -70.5671755316439],
            [-33.43826837794649, -70.5677878781579],
            [-33.438236296838994, -70.56818530038636],
            [-33.43821268659794, -70.5686259016903],
            [-33.438191116112975, -70.5689051884747],
            [-33.43814674806848, -70.56956055000931],
            [-33.438038470145926, -70.57098924240151],
            [-33.43804380710232, -70.57127976973571],
            [-33.43804162640566, -70.57145183774614],
            [-33.43795558818142, -70.5725474693935],
            [-33.43795408777237, -70.57266576596106],
            [-33.43790082008256, -70.57331020599199],
            [-33.437907106993485, -70.57352545322604],
            [-33.43785027922507, -70.57373956081857],
            [-33.437831018041344, -70.57383602311201],
            [-33.437802467422905, -70.57395383094776],
            [-33.43780219438684, -70.57397533936295],
            [-33.43778347912414, -70.57402878472469],
            [-33.4377271966638, -70.5741998748646],
            [-33.43759741778752, -70.57447720360102],
            [-33.437116001390535, -70.57545811270828],
            [-33.43715111014233, -70.57553404346918],
            [-33.43707870625707, -70.5755542477784],
            [-33.436985673116446, -70.5757784539369],
            [-33.43692938831301, -70.57594954130136],
            [-33.43688266639913, -70.57607777515231],
            [-33.43689974213091, -70.57615337983638],
            [-33.43677829169593, -70.57648463632127],
            [-33.4366184500584, -70.57699805816922],
            [-33.436599186396215, -70.57709451828475],
            [-33.43647691261516, -70.5774902963848],
            [-33.436314876984476, -70.57817577850892],
            [-33.43611951093958, -70.57864552512903],
            [-33.43600816586777, -70.57889090659678],
            [-33.43571224798278, -70.5794663919541],
            [-33.43562932030261, -70.57960472231535],
            [-33.435065758333025, -70.58065938506456],
            [-33.434540310509, -70.58155338191781],
            [-33.4340707383373, -70.58230855181584],
            [-33.43405243128432, -70.5823297318782],
            [-33.4339884938077, -70.58239310833294],
            [-33.43367535140807, -70.58290371868314],
            [-33.43318037053872, -70.58352933919629],
            [-33.43283239483752, -70.58394250340307],
            [-33.43270410617073, -70.58410151266429],
            [-33.43258552055077, -70.58420691776556],
            [-33.43252240651066, -70.5842057707627],
            [-33.43235860195717, -70.58432110965512],
            [-33.43219465989866, -70.58444720158406],
            [-33.4318580339889, -70.58467771329946],
            [-33.431784666801015, -70.58477318277336],
            [-33.43166731759529, -70.58478180532639],
            [-33.4315122539507, -70.58491881272205],
            [-33.43140282143205, -70.58501362588254],
            [-33.4312384663296, -70.58517197519194],
            [-33.431119467438705, -70.5853096370835],
            [-33.43108285236639, -70.58535199451303],
            [-33.43075345361464, -70.58572245650193],
            [-33.43071573825434, -70.58585083975866],
            [-33.4306340415731, -70.58589237666328],
            [-33.42942600607923, -70.58726863100024],
            [-33.428913384999944, -70.58786160876076],
            [-33.42839174497037, -70.58845441528311],
            [-33.42809826483215, -70.58883626431036],
            [-33.42806983822908, -70.58894330068458],
            [-33.427997708010594, -70.58894198613132],
            [-33.42713611978969, -70.59002332736263],
            [-33.426906438498115, -70.5903525529312],
            [-33.42687842436063, -70.59042732898433],
            [-33.42628298706605, -70.59114782250316],
            [-33.42566827100828, -70.591964750523],
            [-33.4251091665231, -70.59266437717145],
            [-33.42476976402408, -70.59310988895744],
            [-33.42453092053493, -70.59344968508222],
            [-33.42397166990501, -70.59416004543121],
            [-33.423211430305486, -70.59507106248248],
            [-33.42242330538502, -70.59604608178667],
            [-33.42158926120104, -70.59708477039987],
            [-33.42062510155942, -70.598422180972],
            [-33.420461007561826, -70.59855898167712],
            [-33.420121446397204, -70.59901519853179],
            [-33.42002920446555, -70.59917482370771],
            [-33.41993779423734, -70.59926993730392],
            [-33.41943316435075, -70.59993820794253],
            [-33.41943191598311, -70.6000349742064],
            [-33.41901910972052, -70.60057587024143],
            [-33.41866137024536, -70.60104249230731],
            [-33.4185515097764, -70.60116952648985],
            [-33.418405306600654, -70.60131740155565],
            [-33.41830501741519, -70.60140159392886],
            [-33.41823191571876, -70.6014755311227],
            [-33.418123304381055, -70.60150579940121],
            [-33.41804188058221, -70.60152581265726],
            [-33.41797821157667, -70.60156766023628],
            [-33.417968223443054, -70.60164275600238],
            [-33.41795823526446, -70.60171785174938],
            [-33.4179476915988, -70.60183595393548],
            [-33.41790080513558, -70.60197489690091],
            [-33.417872506526564, -70.60207116453053],
            [-33.41786321252543, -70.60209250212331],
            [-33.417806753956505, -70.60227428555659],
            [-33.41770257440689, -70.60265952051783],
            [-33.41756038315336, -70.60319461350811],
            [-33.41751280024035, -70.60338731283447],
            [-33.417481720303485, -70.60369861049463],
            [-33.417496972128596, -70.60391397302482],
            [-33.41752151792047, -70.60410799833808],
            [-33.41756479121734, -70.60424859765884],
            [-33.41765119822419, -70.6045405482652],
            [-33.417745786002584, -70.60489717476383],
            [-33.41776284453453, -70.60497276759949],
            [-33.41780667340093, -70.60507036138274],
            [-33.41787713339233, -70.6052007078242],
            [-33.417948149893355, -70.60528804808833],
            [-33.419581306719635, -70.60592035200486],
            [-33.419635125561435, -70.60594285173524],
            [-33.41975122252049, -70.60603102457128],
            [-33.419804623629126, -70.60608577988044],
            [-33.41985788546823, -70.60615128708419],
            [-33.41985788546823, -70.60615128708419],
            [-33.4199200242332, -70.60622771225628],
            [-33.41996426977854, -70.60629305357108],
            [-33.42002612992164, -70.60639098263032],
            [-33.420078555946546, -70.6065210013014],
            [-33.42012238347788, -70.60661859845281],
            [-33.4201920058804, -70.60681346080814],
            [-33.420226816963044, -70.60691089209853],
            [-33.4202872833544, -70.60711634063155],
            [-33.4203481674319, -70.6072895337926],
            [-33.42053235139435, -70.60769084375744],
            [-33.42070863308602, -70.6080059737513],
            [-33.42076133618786, -70.60811449050094],
            [-33.42103484263903, -70.6085819787764],
            [-33.421352730708165, -70.60910406170527],
            [-33.42137894225637, -70.60916907278342],
            [-33.42164384696324, -70.60960414508769],
            [-33.4216883697356, -70.60964798530128],
            [-33.42182096097164, -70.60985477056127],
            [-33.42194411687419, -70.61009364617078],
            [-33.422359500552716, -70.61074659703029],
            [-33.42264243176762, -70.61118201208208],
            [-33.42281898352154, -70.61147565223972],
            [-33.423049491900436, -70.61178104564846],
            [-33.423191514819905, -70.61195574736762],
            [-33.42358179686953, -70.61245768453323],
            [-33.42367014113703, -70.61259913118388],
            [-33.42393615186751, -70.61294820678194],
            [-33.42407845273687, -70.61310140755002],
            [-33.42417777053843, -70.61309248994195],
            [-33.42413185047597, -70.61315616988824],
            [-33.424683438996105, -70.61373638784241],
            [-33.4251014615658, -70.61418508014206],
            [-33.42562641632749, -70.61473255271838],
            [-33.42639933864304, -70.61562879150279],
            [-33.42647062738491, -70.61569464360015],
            [-33.42691470969873, -70.61621912443617],
            [-33.42705588486693, -70.61645835709675],
            [-33.42727624226977, -70.61684963277385],
            [-33.42747898675811, -70.6172083177937],
            [-33.427584936790815, -70.61738236818879],
            [-33.427751474773515, -70.6177511392428],
            [-33.42801326017345, -70.61842282988398],
            [-33.428109630852255, -70.61863972650578],
            [-33.42835464267463, -70.6192143122484],
            [-33.42882662573584, -70.6203631580272],
            [-33.42889706866219, -70.62049353300318],
            [-33.42915235278019, -70.62097152047643],
            [-33.429876489146814, -70.62214658902413],
            [-33.42999313612876, -70.6221917819263],
            [-33.43002709046383, -70.62235374793727],
            [-33.43018628541929, -70.62259333441173],
            [-33.43045184381777, -70.62297472539123],
            [-33.43098422409254, -70.62364073632389],
            [-33.43112580661125, -70.62384773247987],
            [-33.431534914449394, -70.62428558503414],
            [-33.431721576380866, -70.6244934236278],
            [-33.431943597893394, -70.6247557013717],
            [-33.43224535451365, -70.6251270256742],
            [-33.43242497204309, -70.62518415380796],
            [-33.43245878132986, -70.62535687865679],
            [-33.43258303339707, -70.62550977834877],
            [-33.43277870919851, -70.62571779022431],
            [-33.43296536851049, -70.62592563486376],
            [-33.43348181527047, -70.62643004553968],
            [-33.433543940607656, -70.62650649699681],
            [-33.433643681965954, -70.6264653339423],
            [-33.433615081996194, -70.62658311680909],
            [-33.4337038323158, -70.62669233353273],
            [-33.43389077202282, -70.62687867558677],
            [-33.43412166301626, -70.62715188773954],
            [-33.43436128716915, -70.62744677668373],
            [-33.43446764539378, -70.62758859247154],
            [-33.43488053000604, -70.62842452970804],
            [-33.43504183102912, -70.62850283679285],
            [-33.4349942081585, -70.62869555886482],
            [-33.43561654481035, -70.63006248031917],
            [-33.43571543898044, -70.63008584244199],
            [-33.43567767806047, -70.63021421176019],
            [-33.435774309834414, -70.63040963265674],
            [-33.43586192520462, -70.63060488530158],
            [-33.436141528242516, -70.6312877663295],
            [-33.43615899445976, -70.63133111864165],
            [-33.43654183150662, -70.63239241123254],
            [-33.43666295901333, -70.63278191068896],
            [-33.43668717475413, -70.63299749261698],
            [-33.436691658095135, -70.63334178185104],
            [-33.43665284869337, -70.6342338363623],
            [-33.43663410785565, -70.63428726698041],
            [-33.43662409955877, -70.63436237413165],
            [-33.436623107279594, -70.63443765034147],
            [-33.436631131017116, -70.63451309563318],
            [-33.4366481707703, -70.63458871003037],
            [-33.43667436831486, -70.63465373980769],
            [-33.43670042404146, -70.634729523375],
            [-33.43675437862514, -70.63474129178566],
            [-33.43678085966352, -70.63478481416303],
            [-33.43682551459868, -70.6348179210385],
            [-33.43686115346314, -70.63485085882647],
            [-33.43689707591026, -70.63486228909073],
            [-33.436932005758244, -70.63494899582238],
            [-33.43708215886779, -70.63518845463135],
            [-33.437198658493244, -70.63524442275067],
            [-33.437160324871506, -70.63541580698163],
            [-33.43745296544718, -70.6364754354595],
            [-33.437569464425295, -70.63653140553427],
            [-33.43752324859769, -70.63661658978249],
            [-33.43780409551409, -70.63720271705685],
            [-33.43798029801583, -70.63751796748156],
            [-33.43809494992891, -70.63771374010938],
            [-33.438360743190735, -70.6380737029468],
            [-33.43846879363494, -70.638086490484],
            [-33.43844905651337, -70.63821519894321],
            [-33.43936150378256, -70.63945861854337],
            [-33.439442505902754, -70.63947089914298],
            [-33.43943220999004, -70.63956751609652],
            [-33.44007800420117, -70.64051550927472],
            [-33.44021267545368, -70.64056107182796],
            [-33.440228288246395, -70.64074423194008],
            [-33.44089196249258, -70.64170333631341],
            [-33.44141407961617, -70.64245540431268],
            [-33.44162618950962, -70.64278211236697],
            [-33.44181096537921, -70.6431298206481],
            [-33.44197713794229, -70.64352020770804],
            [-33.4421690738271, -70.64400789589111],
            [-33.4421863927976, -70.64406200799168],
            [-33.4421863927976, -70.64406200799168],
            [-33.44237561584369, -70.6447540320473],
            [-33.442521610369795, -70.6453054003222],
            [-33.44271770045675, -70.64615891628634],
            [-33.44282460725335, -70.64625775025598],
            [-33.44275992433707, -70.64637485668646],
            [-33.44282776743872, -70.6466988528432],
            [-33.44301483173851, -70.64755220408256],
            [-33.443095404001326, -70.64759675625112],
            [-33.44304889476076, -70.64770344850696],
            [-33.44331251920731, -70.64890248278364],
            [-33.44332983598628, -70.64895659648488],
            [-33.44335588263332, -70.64903238982743],
            [-33.4434931279018, -70.64956209101481],
            [-33.44356926285997, -70.64994003535297],
            [-33.44369820404032, -70.65041579567956],
            [-33.44382528152397, -70.65103136641105],
            [-33.443850753940474, -70.65115017893964],
            [-33.44393418066679, -70.65165735155722],
            [-33.443942480238796, -70.65171129523382],
            [-33.444195758630954, -70.65300697254254],
            [-33.44445002777916, -70.65422737461041],
            [-33.44447592761008, -70.65431392498387],
            [-33.44461286270141, -70.65486514963843],
            [-33.44475809319322, -70.65547032040084],
            [-33.444783274025326, -70.65561064459982],
            [-33.44479958237762, -70.65574004290045],
            [-33.44519232879057, -70.65739339086427],
            [-33.445482329866564, -70.65863601389913],
            [-33.44561794983329, -70.6592840434275],
            [-33.44581466175024, -70.660083843614],
            [-33.445857581067, -70.66024602373159],
            [-33.44585729300481, -70.66026753321924],
            [-33.44585729300481, -70.66026753321924],
            [-33.445925675302355, -70.66054853123805],
            [-33.445951282479484, -70.66065659429059],
            [-33.445959866206834, -70.66068903040335],
            [-33.44614784120183, -70.66146715505693],
            [-33.44616457578082, -70.66156429190198],
            [-33.44641190672751, -70.66262324905294],
            [-33.44666737834136, -70.66374691297071],
            [-33.44687249909161, -70.66458992335822],
            [-33.447128964035095, -70.66563831416744],
            [-33.44719733388457, -70.66591932001643],
            [-33.4473525371573, -70.66644941320139],
            [-33.44762046108326, -70.66731515352777],
            [-33.447755120928136, -70.66736076154119],
            [-33.44770714817446, -70.66757499742376],
            [-33.44789580263444, -70.66829937606381],
            [-33.448048204359594, -70.66836684100433],
            [-33.447938421438096, -70.66848307359065],
            [-33.44809288943888, -70.66906695029094],
            [-33.44843614157094, -70.67036446109528],
            [-33.448597557915534, -70.67043210293909],
            [-33.448470321089154, -70.67050496771905],
            [-33.44877094402506, -70.6716187884183],
            [-33.44909700787074, -70.67285144159989],
            [-33.44923224591135, -70.67285403859282],
            [-33.449148635639716, -70.67303531676886],
            [-33.4493291128124, -70.67369501414152],
            [-33.44947468504572, -70.67426798004217],
            [-33.449645550641485, -70.67430353780527],
            [-33.44952703702839, -70.67439808116971],
            [-33.44982704260228, -70.67555494804405],
            [-33.44998845574661, -70.67562260057807],
            [-33.44988782750009, -70.6757282444792],
            [-33.450084576249594, -70.67651736160175],
            [-33.450244970529674, -70.67666030248854],
            [-33.450171388979705, -70.67676646608254],
            [-33.450445780122614, -70.67781527566467],
            [-33.45060733744967, -70.67787217763176],
            [-33.450489112417856, -70.67794520656855],
            [-33.45054000442544, -70.67818286351888],
            [-33.450718414142635, -70.67899315440226],
            [-33.45086279545877, -70.67965217936734],
            [-33.450913975631416, -70.67986832767932],
            [-33.450992494457644, -70.68006348737123],
            [-33.45109820624713, -70.68024841385896],
            [-33.45122209520871, -70.68042293335517],
            [-33.45132780642925, -70.6806078607555],
            [-33.451423918187416, -70.68083563590204],
            [-33.45151043024534, -70.68110625884948],
            [-33.451739704559124, -70.6821542262351],
            [-33.45179916619788, -70.68242432893838],
            [-33.451892062359434, -70.68288872523733],
            [-33.451926227332116, -70.68302924178559],
            [-33.45196853169213, -70.68323446489043],
            [-33.452045292193695, -70.68355869435163],
            [-33.45213062932531, -70.68391536480897],
            [-33.45224096681401, -70.68442313452343],
            [-33.45236874900588, -70.68497427589428],
            [-33.45252084811541, -70.68506328428883],
            [-33.45242006588725, -70.68517967528359],
            [-33.453007475957065, -70.68774076098181],
            [-33.45314271287796, -70.6877433814711],
            [-33.45303349822204, -70.68781657342778],
            [-33.453203413815245, -70.68858370791547],
            [-33.45335690534614, -70.68923218485688],
            [-33.45348327294129, -70.68922387731351],
            [-33.45337391088675, -70.6893078231536],
            [-33.45368058934454, -70.69062629505163],
            [-33.453689165035264, -70.69065873668404],
            [-33.45369788741761, -70.69068042277819],
            [-33.453723174290474, -70.69081001436798],
            [-33.453732043358215, -70.69082094493695],
            [-33.45377462800882, -70.69100466444536],
            [-33.45377448128004, -70.69101541999737],
            [-33.45380878357345, -70.69114518684015],
            [-33.45381750586804, -70.69116687300955],
            [-33.45382608141378, -70.69119931474053],
            [-33.454064578027186, -70.69222599706113],
            [-33.454190945675016, -70.69221769385004],
            [-33.45407285961085, -70.692279950141],
            [-33.45436279678151, -70.69350129067162],
            [-33.45464326471895, -70.69475473032679],
            [-33.45489917414844, -70.69582480455311],
            [-33.45506929623556, -70.69591418545538],
            [-33.454967915459434, -70.69607358939687],
            [-33.455087070608165, -70.69659232031692],
            [-33.45523179809865, -70.6972191365946],
            [-33.455367034307756, -70.69722177201845],
            [-33.45524820953272, -70.69733780067483],
            [-33.4552819158633, -70.69751059474416],
            [-33.45530749006803, -70.69761867896834],
            [-33.45538435943986, -70.6979321762864],
            [-33.45546078590715, -70.6982779412854],
            [-33.45553691659561, -70.69864521830578],
            [-33.45569050176541, -70.69928297245663],
            [-33.45609107927834, -70.70097989918388],
            [-33.45625173869459, -70.70110138262693],
            [-33.456167939954284, -70.70129340194188],
            [-33.45630377510835, -70.70190930084142],
            [-33.456516759345924, -70.70281719510182],
            [-33.456576174989806, -70.70308732487105],
            [-33.45661948006167, -70.70321727645434],
            [-33.456661602481674, -70.70343327487868],
            [-33.45677244974253, -70.70389806903512],
            [-33.45708739335194, -70.7052598374459],
            [-33.45715567126038, -70.70554090288731],
            [-33.457173110654054, -70.70558427958663],
            [-33.45719025400997, -70.70564916808733],
            [-33.457189513938744, -70.70570294754725],
            [-33.45721522886459, -70.7058002803568],
            [-33.4572815807935, -70.70622117329427],
            [-33.45736892446068, -70.70642730199687],
            [-33.45747178136244, -70.70681663512707],
            [-33.45757330363611, -70.707302772503],
            [-33.45764113225622, -70.70761610873542],
            [-33.4578969281366, -70.70868625302981],
            [-33.457956034104754, -70.70897790249133],
            [-33.45796282513222, -70.70913941895012],
            [-33.45810099428651, -70.709583245453],
            [-33.45819497374539, -70.70996165215313],
            [-33.45832071007735, -70.71065269205562],
            [-33.458318186286, -70.71083554410767],
            [-33.458357473778, -70.71125591397998],
            [-33.45840622112079, -70.71164419335427],
            [-33.45842955443201, -70.71191362525698],
            [-33.45844372289618, -70.71219363602381],
            [-33.45843941355201, -70.71250556028853],
            [-33.4584254931923, -70.71286033117465],
            [-33.458413950469726, -70.71304300588258],
            [-33.45833340407694, -70.71299838573813],
            [-33.45824280142465, -70.71302888020327],
            [-33.45817037876113, -70.71304897334383],
            [-33.45803425177058, -70.71311084879716],
            [-33.457952367430465, -70.7131630323021],
            [-33.457824661363404, -70.71326810851494],
            [-33.457778839635196, -70.71332100126287],
            [-33.45770582219788, -70.71338411771914],
            [-33.45765098475591, -70.71343683294543],
            [-33.45762334298885, -70.7134793243866],
            [-33.45756820811282, -70.7135535512927],
            [-33.457520304329925, -70.71375702616744],
            [-33.45746219465244, -70.71404637039431],
            [-33.45743276767707, -70.71421793203753],
            [-33.45729657966353, -70.71493608983104],
            [-33.45723302357862, -70.71496711457682],
            [-33.45714563136727, -70.71541726168742],
            [-33.457067997683, -70.71581380636171],
            [-33.4571031669344, -70.71587905183202],
            [-33.45703901502219, -70.71595309907958],
            [-33.45689350354392, -70.71669258435317],
            [-33.456937539004265, -70.71676876355005],
            [-33.45691801789699, -70.7168759660517],
            [-33.456587189076345, -70.71862311040132],
            [-33.45631699751337, -70.7198980580864],
            [-33.456250007373974, -70.72017645983068],
            [-33.456158358268844, -70.72028223589398],
            [-33.45591663604777, -70.72080463258322],
            [-33.4558344500581, -70.72087831880478],
            [-33.45574235237368, -70.72101636049861],
            [-33.45560472831683, -70.72118577785562],
            [-33.455357572100034, -70.72144985655457],
            [-33.45516600308206, -70.72160744761099],
            [-33.45498359891315, -70.72175446068768],
            [-33.45484716920228, -70.72183783131766],
            [-33.454756265837396, -70.72188982642969],
            [-33.454738085162056, -70.72190022543947],
            [-33.45472892011772, -70.72191080269123],
            [-33.454701275563515, -70.72195328992643],
            [-33.454501437463605, -70.72205692311955],
            [-33.45423893816098, -70.7221270416663],
            [-33.45399461951902, -70.72218676096152],
            [-33.453615215811276, -70.72223305048742],
            [-33.4534708162635, -70.72224095348437],
            [-33.45266737890911, -70.72230037428264],
            [-33.452225015126906, -70.72233465976156],
            [-33.45175545497296, -70.72237916530023],
            [-33.45075352400647, -70.7224454173343],
            [-33.449697499081225, -70.72251059871915],
            [-33.44928218201988, -70.72254541746923],
            [-33.448867014380355, -70.72256948120729],
            [-33.4484425321823, -70.72261487596532],
            [-33.44737749127374, -70.7226798765599],
            [-33.44697118971096, -70.72271487235321],
            [-33.44651995937776, -70.7227382220383],
            [-33.44568045865914, -70.72279692330405],
            [-33.44562412289894, -70.72295716916136],
            [-33.44563752021917, -70.72329091116104],
            [-33.44567223726006, -70.72338841381146]
        ]
####################################################################################
# HARDCODED for development purpose
####################################################################################

        limits = [int(1.0*i*len(route_points)/(max_section)) for i in range(max_section)]+[len(route_points)-1]
        response['start_end'] = list(zip(limits[:-1], limits[1:]))
        response['route'] = {'name': route, 'points': route_points}
        return JsonResponse(response, safe=False)
